<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wavelength Input</title>
</head>
<body>
    <input type="number" id="start" name="start" placeholder="WL Start" title="wavelength start value" value="0">
    <input type="number" id="stop" name="stop" placeholder="WL Stop" title="wavelength stop value">
    <input type="number" id="step" name="step" placeholder="WL Step" title="wavelength step">
    <button id="generate">Generate</button>
    <div id="message"></div>

    <script >
    document.getElementById('generate').addEventListener('click', function() {
    const start = parseFloat(document.getElementById('start').value);
    const stop  = parseFloat(document.getElementById('stop').value);
    const step  = parseFloat(document.getElementById('step').value);

    if (isNaN(start) || isNaN(stop) || isNaN(step)) {
        alert('Please enter valid numerical values.');
        return;
    }

    const rangeKey = `range_${step}`;
    console.log(rangeKey);
    const storedData = localStorage.getItem(rangeKey);

    let X = [], Y = [];
    
    for (let i = start; i <= stop; i += step) {
        X.push(i);
        Y.push(Math.random()); // Example Y values, replace with actual data generation
    }

    if (storedData) {
        const { Xref, Yref } = JSON.parse(storedData);
        console.log("X length : "+X.length)
        console.log("Y length : "+Y.length)
        console.log("Xref length : "+Xref.length)
        console.log("Yref length : "+Yref.length)
        console.log("Stop value : "+stop)
        console.log("Xref last value : "+Xref[Xref.length-1])
        
        if (stop < Xref[Xref.length-1]) {
            alert('Stored reference data length does not match the current data length. Please perform the zero method again.');
            alert('no need to perfom zero method');
            const Xadjusted = X.map((x, index) => x );
            const Yadjusted = Y.map((y, index) => y - Yref[index]);
            displayResults(Xadjusted, Yadjusted);    
        }
            if(stop > Xref[Xref.length-1]){
                alert('we need to perform zero method');
                document.getElementById('start').value = Xref[Xref.length-1];
                performZeroMethod(rangeKey, X, Y);
            }
        else {
            const Xadjusted = X.map((x, index) => x );
            const Yadjusted = Y.map((y, index) => y - Yref[index]);
            displayResults(Xadjusted, Yadjusted);
        }
    } else {
        performZeroMethod(rangeKey, X, Y);
    }
});

function performZeroMethod(rangeKey, X, Y) {
    // Implement zero method here. For now, using dummy Xref and Yref
    const Xref = X.map(x => x); // Example Xref values
    const Yref = Y.map(y => y * 0.5); // Example Yref values

    localStorage.setItem(rangeKey, JSON.stringify({ Xref, Yref }));
    alert('Zero method performed and reference data stored.');

    const Xadjusted = X.map((x, index) => x);
    const Yadjusted = Y.map((y, index) => y - Yref[index]);
    displayResults(Xadjusted, Yadjusted);
}

function displayResults(X, Y) {
    const messageDiv = document.getElementById('message');
    messageDiv.innerHTML = `<p>X: ${X.join(', ')}</p><p>Y: ${Y.join(', ')}</p>`;
}

    </script>
</body>
</html>
